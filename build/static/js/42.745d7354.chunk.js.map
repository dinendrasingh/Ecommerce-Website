{"version":3,"sources":["pages/Checkout.js","functions/user.js"],"names":["Checkout","history","useState","products","setProducts","total","setTotal","address","setAddress","addressSaved","setAddressSaved","coupon","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","useDispatch","useSelector","state","user","COD","couponTrueOrFalse","useEffect","getUserCart","token","then","res","console","log","JSON","stringify","data","cartTotal","saveAddressToDb","saveUserAddress","ok","toast","success","applyDiscountCoupon","applyCoupon","type","payload","err","className","theme","value","onChange","onClick","e","target","length","map","p","i","product","title","color","count","price","disabled","createCashOrderForUser","window","localStorage","removeItem","emptyUserCart","setTimeout","push","userCart","cart","authtoken","a","axios","post","process","headers","get","delete","createOrder","stripeResponse","getUserOrders","getWishlist","removeWishlist","productId","put","addToWishlist","couponApplied"],"mappings":"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","file":"static/js/42.745d7354.chunk.js","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { toast } from \"react-toastify\";\r\nimport {\r\n  getUserCart,\r\n  emptyUserCart,\r\n  saveUserAddress,\r\n  applyCoupon,\r\n  createCashOrderForUser,\r\n} from \"../functions/user\";\r\nimport ReactQuill from \"react-quill\";\r\nimport \"react-quill/dist/quill.snow.css\";\r\n\r\nconst Checkout = ({ history }) => {\r\n  const [products, setProducts] = useState([]);\r\n  const [total, setTotal] = useState(0);\r\n  const [address, setAddress] = useState(\"\");\r\n  const [addressSaved, setAddressSaved] = useState(false);\r\n  const [coupon, setCoupon] = useState(\"\");\r\n  // discount price\r\n  const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\r\n  const [discountError, setDiscountError] = useState(\"\");\r\n\r\n  const dispatch = useDispatch();\r\n  const { user, COD } = useSelector((state) => ({ ...state }));\r\n  const couponTrueOrFalse = useSelector((state) => state.coupon);\r\n\r\n  useEffect(() => {\r\n    getUserCart(user.token).then((res) => {\r\n      console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\r\n      setProducts(res.data.products);\r\n      setTotal(res.data.cartTotal);\r\n    });\r\n  }, []);\r\n\r\n  const emptyCart = () => {\r\n    // remove from local storage\r\n    if (typeof window !== \"undefined\") {\r\n      localStorage.removeItem(\"cart\");\r\n    }\r\n    // remove from redux\r\n    dispatch({\r\n      type: \"ADD_TO_CART\",\r\n      payload: [],\r\n    });\r\n    // remove from backend\r\n    emptyUserCart(user.token).then((res) => {\r\n      setProducts([]);\r\n      setTotal(0);\r\n      setTotalAfterDiscount(0);\r\n      setCoupon(\"\");\r\n      toast.success(\"Cart is emapty. Contniue shopping.\");\r\n    });\r\n  };\r\n\r\n  const saveAddressToDb = () => {\r\n    // console.log(address);\r\n    saveUserAddress(user.token, address).then((res) => {\r\n      if (res.data.ok) {\r\n        setAddressSaved(true);\r\n        toast.success(\"Address saved\");\r\n      }\r\n    });\r\n  };\r\n\r\n  const applyDiscountCoupon = () => {\r\n    console.log(\"send coupon to backend\", coupon);\r\n    applyCoupon(user.token, coupon).then((res) => {\r\n      console.log(\"RES ON COUPON APPLIED\", res.data);\r\n      if (res.data) {\r\n        setTotalAfterDiscount(res.data);\r\n        // update redux coupon applied true/false\r\n        dispatch({\r\n          type: \"COUPON_APPLIED\",\r\n          payload: true,\r\n        });\r\n      }\r\n      // error\r\n      if (res.data.err) {\r\n        setDiscountError(res.data.err);\r\n        // update redux coupon applied true/false\r\n        dispatch({\r\n          type: \"COUPON_APPLIED\",\r\n          payload: false,\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  const showAddress = () => (\r\n    <>\r\n      <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\r\n      <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\r\n        Save\r\n      </button>\r\n    </>\r\n  );\r\n\r\n  const showProductSummary = () =>\r\n    products.map((p, i) => (\r\n      <div key={i}>\r\n        <p>\r\n          {p.product.title} ({p.color}) x {p.count} ={\" \"}\r\n          {p.product.price * p.count}\r\n        </p>\r\n      </div>\r\n    ));\r\n\r\n  const showApplyCoupon = () => (\r\n    <>\r\n      <input\r\n        onChange={(e) => {\r\n          setCoupon(e.target.value);\r\n          setDiscountError(\"\");\r\n        }}\r\n        value={coupon}\r\n        type=\"text\"\r\n        className=\"form-control\"\r\n      />\r\n      <button onClick={applyDiscountCoupon} className=\"btn btn-primary mt-2\">\r\n        Apply\r\n      </button>\r\n    </>\r\n  );\r\n\r\n  const createCashOrder = () => {\r\n    createCashOrderForUser(user.token, COD, couponTrueOrFalse).then((res) => {\r\n      console.log(\"USER CASH ORDER CREATED RES \", res);\r\n      // empty cart form redux, local Storage, reset coupon, reset COD, redirect\r\n      if (res.data.ok) {\r\n        // empty local storage\r\n        if (typeof window !== \"undefined\") localStorage.removeItem(\"cart\");\r\n        // empty redux cart\r\n        dispatch({\r\n          type: \"ADD_TO_CART\",\r\n          payload: [],\r\n        });\r\n        // empty redux coupon\r\n        dispatch({\r\n          type: \"COUPON_APPLIED\",\r\n          payload: false,\r\n        });\r\n        // empty redux COD\r\n        dispatch({\r\n          type: \"COD\",\r\n          payload: false,\r\n        });\r\n        // mepty cart from backend\r\n        emptyUserCart(user.token);\r\n        // redirect\r\n        setTimeout(() => {\r\n          history.push(\"/user/history\");\r\n        }, 1000);\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"row\">\r\n      <div className=\"col-md-6\">\r\n        <h4>Delivery Address</h4>\r\n        <br />\r\n        <br />\r\n        {showAddress()}\r\n        <hr />\r\n        <h4>Got Coupon?</h4>\r\n        <br />\r\n        {showApplyCoupon()}\r\n        <br />\r\n        {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\r\n      </div>\r\n\r\n      <div className=\"col-md-6\">\r\n        <h4>Order Summary</h4>\r\n        <hr />\r\n        <p>Products {products.length}</p>\r\n        <hr />\r\n        {showProductSummary()}\r\n        <hr />\r\n        <p>Cart Total: {total}</p>\r\n\r\n        {totalAfterDiscount > 0 && (\r\n          <p className=\"bg-success p-2\">\r\n            Discount Applied: Total Payable: ${totalAfterDiscount}\r\n          </p>\r\n        )}\r\n\r\n        <div className=\"row\">\r\n          <div className=\"col-md-6\">\r\n            {COD ? (\r\n              <button\r\n                className=\"btn btn-primary\"\r\n                disabled={!addressSaved || !products.length}\r\n                onClick={createCashOrder}\r\n              >\r\n                Place Order\r\n              </button>\r\n            ) : (\r\n              <button\r\n                className=\"btn btn-primary\"\r\n                disabled={!addressSaved || !products.length}\r\n                onClick={() => history.push(\"/payment\")}\r\n              >\r\n                Place Order\r\n              </button>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"col-md-6\">\r\n            <button\r\n              disabled={!products.length}\r\n              onClick={emptyCart}\r\n              className=\"btn btn-primary\"\r\n            >\r\n              Empty Cart\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Checkout;\r\n","import axios from \"axios\";\r\n\r\nexport const userCart = async (cart, authtoken) =>\r\n  await axios.post(\r\n    `${process.env.REACT_APP_API}/user/cart`,\r\n    { cart },\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n\r\nexport const getUserCart = async (authtoken) =>\r\n  await axios.get(`${process.env.REACT_APP_API}/user/cart`, {\r\n    headers: {\r\n      authtoken,\r\n    },\r\n  });\r\n\r\nexport const emptyUserCart = async (authtoken) =>\r\n  await axios.delete(`${process.env.REACT_APP_API}/user/cart`, {\r\n    headers: {\r\n      authtoken,\r\n    },\r\n  });\r\n\r\nexport const saveUserAddress = async (authtoken, address) =>\r\n  await axios.post(\r\n    `${process.env.REACT_APP_API}/user/address`,\r\n    { address },\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n\r\nexport const applyCoupon = async (authtoken, coupon) =>\r\n  await axios.post(\r\n    `${process.env.REACT_APP_API}/user/cart/coupon`,\r\n    { coupon },\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n\r\nexport const createOrder = async (stripeResponse, authtoken) =>\r\n  await axios.post(\r\n    `${process.env.REACT_APP_API}/user/order`,\r\n    { stripeResponse },\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n\r\nexport const getUserOrders = async (authtoken) =>\r\n  await axios.get(`${process.env.REACT_APP_API}/user/orders`, {\r\n    headers: {\r\n      authtoken,\r\n    },\r\n  });\r\n\r\nexport const getWishlist = async (authtoken) =>\r\n  await axios.get(`${process.env.REACT_APP_API}/user/wishlist`, {\r\n    headers: {\r\n      authtoken,\r\n    },\r\n  });\r\n\r\nexport const removeWishlist = async (productId, authtoken) =>\r\n  await axios.put(\r\n    `${process.env.REACT_APP_API}/user/wishlist/${productId}`,\r\n    {},\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n\r\nexport const addToWishlist = async (productId, authtoken) =>\r\n  await axios.post(\r\n    `${process.env.REACT_APP_API}/user/wishlist`,\r\n    { productId },\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n\r\nexport const createCashOrderForUser = async (\r\n  authtoken,\r\n  COD,\r\n  couponTrueOrFalse\r\n) =>\r\n  await axios.post(\r\n    `${process.env.REACT_APP_API}/user/cash-order`,\r\n    { couponApplied: couponTrueOrFalse, COD },\r\n    {\r\n      headers: {\r\n        authtoken,\r\n      },\r\n    }\r\n  );\r\n"],"sourceRoot":""}